# learning_cardinality_estimator_distributed_exploration  
abstract  
## INTRODUCTION  
    分布式数据库和集中式数据库在学习型基数估计方法的差异主要会受以下几个因素的影响 : 垂直分片的影响(已有实验)，水平分片的影响(理论分析 + 实验结果)，分区键等影响。  
    当前已有的学习型基数估计主要分为query-driven，data-driven，hybrid三个方向。 因为query-driven和hybrid方向的因为易受分布式结构的影响暂且不考虑，所以从data-driven方向入手。data-driven方向又分为基于SPN模型和基于生成模型的，其中生成模型的特点是它可以从大量训练数据中建模真实的数据分布，然后通过学到的这个分布去生成新的数据。目前在学习型基数估计方法这一领域中，大部分使用的生成模型是基于深度自回归网络的，如Naru，UAE，此外还有FACE，一种基于normalizing flow生成模型的方法，同样显示了十分出色的性能。可见生成模型十分适合用于解决基数估计问题，gmm(或采用vae)也是一种被广泛使用的生成模型，因此我们将基于gmm(或采用vae)提出一种新的学习型基数估计方法，并在此基础上提出一种适用于分布式数据库的基数估计框架。在分布式环境下进行基数估计时，相比于集中式数据库的基数估计会产生更多的连接操作，因为很多情况下学习型基数估计方法相比于传统基数估计方法产生更接近真实值的估计，因此可以尝试在连接操作时使用连接直方图方法。
## PRELIMINARIES  
    分布式数据库中，~~各个节点中基数估计所求的选择率都是原始定义域中对应基数估计的条件概率，先验信息是划分过程所用的函数 ***一种狄利克雷分布*** 。~~ 在各节点内采样并建模得到的模型(指直方图、ml模型等)，是属于该节点存储数据的条件概率密度函数(或条件概率分布函数)，~~涉及多个表(分布式节点中的表，不一定等于数据库的表)的join的基数估计问题会涉及求相关节点的联合概率密度(或联合分布)。***分布式基数估计和集中式基数估计的主要区别是，前者是从条件概率出发求联合概率(全部属性的子集)，后者是从联合概率(全部属性)出发求条件概率***~~  
## OVERVIEW  
    如果用gmm做，需要先解决组件数量的问题。因此采用基于狄利克雷过程的变分gmm，狄利克雷过程可以用于解决聚簇问题，因为引入了狄利克雷过程，所以使用变分推断训练GMM模型。(因为使用了变分推断，所以可以尝试推广到VAE模型上)，然后根据某种采样方法进行基数估计。  
    分布式学习型基数估计面对的问题 : 以处理表间连接为基础，需要解决 :  
    (1)针对原本单表的基数估计，因为分区操作本来的一个表会形成多个子表，针对一个表的查询会转化成对其子表的连接查询的基数估计。不同划分方法带来的影响，将原本的单表基数估计问题转化为多表连接下的基数估计问题。  
        a.遇到垂直划分时，不能确定不同子表的数据存在相关性。许多已有方法在处理一般的多表连接一般使用全外连接再训练统一模型的方法，但在分布式条件下，需要先采样然后进行全外连接。不能先全外连接再采样，使用分布式数据库不用集中式数据库的原因就是数据规模过大，如果先全外连接就违背了这一前提。因此需要解决一些新产生的问题 :如何采样？如果先采样后连接，随机采样可能会导致主键对不一致无法全外连接。用有条件采样对使用模型对影响？这样训练出对应模型可以解决垂直划分的影响(如何回避全外连接固有的问题？)要是想保证不同表中采样样本一定能连接，相当于进行查询？。  
        b.遇到水平划分时，可以通过直接相加解决水平划分的影响(涉及分区键)；  
    (2)针对多表连接查询的基数估计，可能转化为多子表间连接查询的基数估计。产生了新的问题 :  
        a.如果利用问题(1)的解决方案，可能需要训练多个问题(1)解决方法产生的模型(最坏情况 : 所有涉及到的表，先在子表内部排列组合，然后作笛卡尔积。)。  
        b.靠独立性假设缩小问题a的求解空间规模？  
    因此对于链接查询，采用连接直方图方法，这种方法不需要考虑列之间的相关性问题。连接直方图所需的单点频率可以通过学习型基数估计方法的点估计基数解决(?还有点问题，还需要分析factorjoin)。  
    分布式基数估计和SPN的差别 : SPN叶节点间的相关性是确定的，有规律的，分布式数据库中各节点间则不一定。 

    所有节点都应该知晓数据库的schema，使用局部的data-driven模型。直接在本地训练模型时不涉及数据传输，但解决各节点中数据间的关系，还需要传输数据到某一个点上，不过不一定是原始数据，也可以是频率、基数等sketch，这一过程涉及到的数据量和传统方法相比能否有所减小？从各节点本地得到的sketch是各节点中数据的一种信息压缩，可以通过使用这些数据，而不是原始数据的样本来计算多表连接下对应的总体模型。q-error不能完全刻画基数估计器在正确率上的特点，从端到端时间方面考虑，越大的基数在查询优化方面会造成的影响越大，所以准确估计大基数的重要性比准确估计小基数大重要性要高。  
## EXPERIMENTAL STUDY  
## RELATED WORKS  
    MSCN
    Naru
    NerouCard
    UAE
    FACE
    deepdb
    factorjoin
## CONCLUSION
## REFERENCES